<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ø¯Ø§Ù„Ø© ğŸ“š</title>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">

<style>
  body {
    margin: 0;
    font-family: 'Tajawal', sans-serif;
    font-weight: 500;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    background: var(--bg-gradient, linear-gradient(-45deg, #00d4ff, #ff4aa3, #00ffa6, #ffcc00));
    background-size: 400% 400%;
    animation: gradient var(--animation-speed, 12s) ease infinite;
  }
  @keyframes gradient {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
  }
  .dark { background: #0f0f0f; color: #f0f0f0; animation: none; }

  .page {
    background: white;
    padding: 30px;
    border-radius: 24px;
    width: 90%;
    max-width: 1100px;
    height: 85vh;
    display: none;
    flex-direction: column;
    opacity: 0;
    transform: translateY(30px);
    transition: all 0.5s ease-out;
    overflow-y: auto;
    box-shadow: 0 10px 30px rgba(0,0,0,0.15);
  }
  .dark .page { background: #1a1a1a; color: #e0e0e0; box-shadow: 0 10px 30px rgba(0,0,0,0.6); }
  .page.active {
    display: flex;
    opacity: 1;
    transform: translateY(0);
  }

  h2, h3 { margin: 12px 0; color: #222; }
  .dark h2, .dark h3 { color: #eee; }

  button {
    padding: 12px 28px;
    margin: 10px 8px;
    border: none;
    border-radius: 16px;
    cursor: pointer;
    background: #00bcd4;
    color: white;
    font-weight: 600;
    font-size: 1.1rem;
    transition: all 0.3s;
  }
  button:hover { transform: translateY(-3px); box-shadow: 0 8px 20px rgba(0,188,212,0.4); }

  .settings-btn { background: #9c27b0; }
  .settings-btn:hover { background: #7b1fa2; }

  .dark-btn { background: #673ab7; }
  .dark-btn:hover { background: #512da8; }

  input, select {
    padding: 14px;
    margin: 10px 0;
    border-radius: 14px;
    border: 1px solid #ddd;
    font-size: 1.1rem;
    font-family: 'Tajawal', sans-serif;
  }

  .options-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 16px;
    margin: 20px 0;
  }

  .checkbox-label {
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 1.15rem;
  }

  /* â˜…â˜…â˜… Ù†Ø¸Ø§Ù… Ø§Ù„Ù†Ø¬ÙˆÙ… â˜…â˜…â˜… */
  .rating-container {
    margin: 20px 0;
    text-align: center;
  }
  .star {
    font-size: 2.5rem;
    cursor: pointer;
    color: #000;
    transition: color 0.2s;
    margin: 0 4px;
  }
  .star.active {
    color: #ffd700; /* Ø°Ù‡Ø¨ÙŠ */
  }

  table {
    border-collapse: collapse;
    margin-top: 20px;
    width: 100%;
    font-size: 1.05rem;
  }
  th, td {
    border: 1px solid #ddd;
    padding: 12px;
    text-align: center;
    min-width: 100px;
  }
  .time-header {
    background: #444;
    color: white;
    font-weight: bold;
  }
  .day-header {
    background: #00bcd4;
    color: white;
    font-weight: bold;
  }
  .settings-section {
    margin: 30px 0;
    padding: 20px;
    background: #f9f9f9;
    border-radius: 16px;
  }
  .dark .settings-section { background: #222; }
</style>
</head>
<body>

<!-- Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
<div class="page active" id="homePage">
  <h2>Ø¯Ø§Ù„Ø© ğŸ“šâœ¨</h2>
  <p>Ù†Ø¸Ù… Ø¯Ø±Ø§Ø³ØªÙƒ Ø¨ÙƒÙ„ Ø³Ù‡ÙˆÙ„Ø© ÙˆÙ…ØªØ¹Ø© ğŸ˜Š</p>

  <h3>Ø¬Ø¯Ø§ÙˆÙ„ÙŠ Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© ğŸ“‹</h3>
  <div id="savedTablesList" style="margin: 24px 0; display: flex; flex-wrap: wrap; gap: 12px;"></div>

  <div style="margin-top: auto; text-align: center;">
    <button onclick="showCustomizePage()">â• Ø¥Ù†Ø´Ø§Ø¡ Ø¬Ø¯ÙˆÙ„ Ø¬Ø¯ÙŠØ¯</button>
    <button class="settings-btn" onclick="openSettings()">âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
  </div>
</div>

<!-- ØµÙØ­Ø© ØªØ®ØµÙŠØµ Ø¬Ø¯ÙˆÙ„ Ø¬Ø¯ÙŠØ¯ -->
<div class="page" id="customizePage">
  <h2>ØªØ®ØµÙŠØµ Ø¬Ø¯ÙˆÙ„Ùƒ Ø§Ù„Ø¬Ø¯ÙŠØ¯ ğŸŒŸ</h2>

  <label>Ø§Ø³Ù… Ø§Ù„Ø¬Ø¯ÙˆÙ„:</label>
  <input id="newTableName" placeholder="Ù…Ø«Ø§Ù„: Ø§Ù„ØªØ±Ù… Ø§Ù„Ø£ÙˆÙ„ Ù¡Ù¤Ù¤Ù§" style="width: 320px;">

  <h3>Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù„ÙŠ ÙÙŠÙ‡Ø§ Ø¯ÙˆØ§Ù… ğŸ—“ï¸</h3>
  <div class="options-grid" id="daysCheckboxes"></div>

  <h3>Ø¹Ø¯Ø¯ Ø§Ù„Ø­ØµØµ Ø§Ù„ÙŠÙˆÙ…ÙŠØ© â°</h3>
  <select id="lessonsCount">
    <option value="5">5 Ø­ØµØµ</option>
    <option value="6" selected>6 Ø­ØµØµ</option>
    <option value="7">7 Ø­ØµØµ</option>
    <option value="8">8 Ø­ØµØµ</option>
    <option value="9">9 Ø­ØµØµ</option>
  </select>

  <div style="margin-top: 40px; text-align: center;">
    <button onclick="backToHome()">Ø±Ø¬ÙˆØ¹</button>
    <button onclick="createCustomizedTable()">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¬Ø¯ÙˆÙ„ â†’ ğŸš€</button>
  </div>
</div>

<!-- ØµÙØ­Ø© Ø§Ù„Ø¬Ø¯ÙˆÙ„ (Ø§Ù„Ø£ÙŠØ§Ù… ÙÙˆÙ‚ØŒ Ø§Ù„Ø­ØµØµ Ø¹Ù„Ù‰ Ø§Ù„ÙŠØ³Ø§Ø±) -->
<div class="page" id="tablePage">
  <div style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
    <h2 id="welcome">Ø¬Ø¯ÙˆÙ„Ùƒ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ ğŸ“…</h2>
    <button onclick="backToHome()">â† Ø±Ø¬ÙˆØ¹</button>
  </div>

  <input id="tableName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¬Ø¯ÙˆÙ„" style="width: 320px;">
  <button onclick="saveCurrentTable()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¬Ø¯ÙˆÙ„</button>

  <button onclick="clearTable()">ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„Ø¬Ø¯ÙˆÙ„</button>

  <table id="table"></table>
</div>

<!-- ØµÙØ­Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª -->
<div class="page" id="settingsPage">
  <h2>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª âš™ï¸ğŸ”¥</h2>

  <div class="settings-section">
    <h3>Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ ğŸŒ™</h3>
    <button class="dark-btn" onclick="toggleDark()">ØªÙØ¹ÙŠÙ„/Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ†</button>
  </div>

  <div class="settings-section">
    <h3>ØªØ®ØµÙŠØµ Ø®Ù„ÙÙŠØ© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ğŸ¨</h3>
    <label>Ù„ÙˆÙ† Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ:</label>
    <input type="color" id="bgColor1" value="#00d4ff">
    <br><br>
    <label>Ù„ÙˆÙ† Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ø«Ø§Ù†ÙŠ:</label>
    <input type="color" id="bgColor2" value="#ff4aa3">
    <br><br>
    <label>Ø³Ø±Ø¹Ø© Ø§Ù„ØªØ¯Ø±Ø¬ (Ø«ÙˆØ§Ù†ÙŠ):</label>
    <input type="number" id="animSpeed" value="12" min="4" max="30" step="1">
    <button onclick="applyBackground()">ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª ğŸŒˆ</button>
  </div>

  <div class="settings-section">
    <h3>ÙƒÙŠÙ ØªØ±Ù‰ ØªØ·Ø¨ÙŠÙ‚Ù†Ø§ØŸ â­</h3>
    <p>Ù‚ÙŠÙ‘Ù…Ù†Ø§ Ù…Ù† 1 Ø¥Ù„Ù‰ 5 Ù†Ø¬ÙˆÙ…</p>
    <div class="rating-container" id="ratingStars"></div>
  </div>

  <div style="margin-top: 50px; text-align: center;">
    <button onclick="backToHome()">Ø±Ø¬ÙˆØ¹ Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ğŸ </button>
  </div>
</div>

<script>
// Ù…ØªØºÙŠØ±Ø§Øª
let currentUser = "guest";
let days = ["Ø§Ù„Ø£Ø­Ø¯", "Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†", "Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡", "Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡", "Ø§Ù„Ø®Ù…ÙŠØ³", "Ø§Ù„Ø¬Ù…Ø¹Ø©", "Ø§Ù„Ø³Ø¨Øª"];
let tables = [];
let currentRating = localStorage.getItem("dalla_rating") || 0;

// ----------------- Ø¯ÙˆØ§Ù„ Ø£Ø³Ø§Ø³ÙŠØ© -----------------
function loadSavedTables() {
  const saved = localStorage.getItem("dalla_tables_" + currentUser);
  if (saved) tables = JSON.parse(saved);
  updateSavedTablesList();
}

function saveAllTables() {
  localStorage.setItem("dalla_tables_" + currentUser, JSON.stringify(tables));
}

function updateSavedTablesList() {
  const container = document.getElementById("savedTablesList");
  container.innerHTML = tables.length === 0 
    ? "<p>Ù…Ø§ Ø¹Ù†Ø¯Ùƒ Ø¬Ø¯Ø§ÙˆÙ„ Ù…Ø­ÙÙˆØ¸Ø© Ø¨Ø¹Ø¯ ğŸ˜”</p>"
    : "";

  tables.forEach((tbl, i) => {
    const btn = document.createElement("button");
    btn.textContent = tbl.name || `Ø¬Ø¯ÙˆÙ„ ${i + 1}`;
    btn.onclick = () => loadTable(tbl);
    btn.oncontextmenu = (e) => {
      e.preventDefault();
      if (confirm(`Ù…ØªØ£ÙƒØ¯ ØªØ¨ÙŠ ØªØ­Ø°Ù "${tbl.name || 'Ù‡Ø°Ø§ Ø§Ù„Ø¬Ø¯ÙˆÙ„'}"ØŸ ğŸ—‘ï¸`)) {
        deleteTable(i);
      }
    };
    container.appendChild(btn);
  });
}

function deleteTable(index) {
  tables.splice(index, 1);
  saveAllTables();
  updateSavedTablesList();
}

function loadTable(tbl) {
  document.getElementById("table").innerHTML = tbl.content;
  document.getElementById("welcome").textContent = tbl.name || "Ø¬Ø¯ÙˆÙ„Ùƒ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ";
  document.getElementById("tableName").value = tbl.name || "";
  switchPage("tablePage");
}

function showHome() {
  loadSavedTables();
  switchPage("homePage");
}

function showCustomizePage() {
  const container = document.getElementById("daysCheckboxes");
  container.innerHTML = "";
  days.forEach(day => {
    const label = document.createElement("label");
    label.className = "checkbox-label";
    label.innerHTML = `<input type="checkbox" name="day" value="${day}" checked> ${day}`;
    container.appendChild(label);
  });
  switchPage("customizePage");
}

function openSettings() {
  switchPage("settingsPage");
  renderStars();  // Ù†Ø¹Ø±Ø¶ Ø§Ù„Ù†Ø¬ÙˆÙ… Ù…Ø¹ Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø­Ø§Ù„ÙŠ
}

function switchPage(pageId) {
  document.querySelectorAll(".page").forEach(p => p.classList.remove("active"));
  document.getElementById(pageId).classList.add("active");
}

function backToHome() {
  switchPage("homePage");
}

// ----------------- Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¬Ø¯ÙˆÙ„ (Ø§Ù„Ø£ÙŠØ§Ù… ÙÙˆÙ‚ØŒ Ø§Ù„Ø­ØµØµ Ø¹Ù„Ù‰ Ø§Ù„ÙŠØ³Ø§Ø±) -----------------
function createCustomizedTable() {
  const name = document.getElementById("newTableName").value.trim() || "Ø¬Ø¯ÙˆÙ„ Ø¬Ø¯ÙŠØ¯";
  const selectedDays = Array.from(document.querySelectorAll('input[name="day"]:checked'))
    .map(cb => cb.value);
  const lessonsCount = parseInt(document.getElementById("lessonsCount").value);

  const table = document.getElementById("table");
  table.innerHTML = "";

  // Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„: Ø§Ù„Ø£ÙŠØ§Ù… (ÙÙˆÙ‚)
  let headerRow = document.createElement("tr");
  headerRow.innerHTML = '<th class="time-header">Ø§Ù„Ø­ØµØ©</th>';
  selectedDays.forEach(day => {
    headerRow.innerHTML += `<th class="day-header">${day}</th>`;
  });
  table.appendChild(headerRow);

  // Ø¨Ø§Ù‚ÙŠ Ø§Ù„ØµÙÙˆÙ: Ø§Ù„Ø­ØµØµ
  for (let i = 1; i <= lessonsCount; i++) {
    let row = document.createElement("tr");
    row.innerHTML = `<th class="time-header">${i}</th>`;
    
    selectedDays.forEach(() => {
      let td = document.createElement("td");
      td.contentEditable = true;
      td.oninput = saveCurrentTable;
      row.appendChild(td);
    });
    
    table.appendChild(row);
  }

  document.getElementById("welcome").textContent = name;
  document.getElementById("tableName").value = name;
  switchPage("tablePage");
}

// ----------------- Ù†Ø¸Ø§Ù… Ø§Ù„Ù†Ø¬ÙˆÙ… -----------------
function renderStars() {
  const container = document.getElementById("ratingStars");
  container.innerHTML = "";

  for (let i = 1; i <= 5; i++) {
    const star = document.createElement("span");
    star.className = "star";
    star.innerHTML = "â˜…";
    star.dataset.value = i;

    if (i <= currentRating) {
      star.classList.add("active");
    }

    star.onclick = () => {
      currentRating = i;
      localStorage.setItem("dalla_rating", currentRating);
      renderStars();
      alert(`Ø´ÙƒØ±Ù‹Ø§! Ù‚ÙŠÙ‘Ù…ØªÙ†Ø§ ${currentRating} Ù†Ø¬ÙˆÙ… â­`);
    };

    container.appendChild(star);
  }
}

// ----------------- Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø¯ÙˆØ§Ù„ -----------------
function saveCurrentTable() {
  const name = document.getElementById("tableName").value.trim() || `Ø¬Ø¯ÙˆÙ„ ${tables.length + 1}`;
  const currentTable = {
    name,
    user: currentUser,
    content: document.getElementById("table").innerHTML
  };

  const idx = tables.findIndex(t => t.name === name);
  if (idx !== -1) tables[idx] = currentTable;
  else tables.push(currentTable);

  saveAllTables();
  updateSavedTablesList();
}

function clearTable() {
  if (confirm("Ù…ØªØ£ÙƒØ¯ ØªØ¨ÙŠ ØªÙ…Ø³Ø­ ÙƒÙ„ Ø´ÙŠØ¡ ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„ØŸ ğŸ§¹")) {
    document.getElementById("table").innerHTML = "";
  }
}

function toggleDark() {
  document.body.classList.toggle("dark");
}

function applyBackground() {
  const c1 = document.getElementById("bgColor1").value;
  const c2 = document.getElementById("bgColor2").value;
  const speed = document.getElementById("animSpeed").value + "s";

  document.body.style.setProperty("--bg-gradient", `linear-gradient(-45deg, ${c1}, ${c2}, #00ffa6, #ffcc00)`);
  document.body.style.setProperty("--animation-speed", speed);
}

// Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
window.onload = showHome;
</script>
</body>
</html>